---
description: Custom Command /issues. Parses markdown changes, creates GitHub Issues (MCP with CLI fallback), and generates auto-close links.
globs: 
alwaysApply: false
---
# Smart Issue Creator

**Trigger:** When the user types `/issues` followed by a Markdown table of changes.

## 1. Context & Pre-Flight
Before processing, the Agent must gather environment context:

1.  **Repo Identity:**
    *   Run `git remote get-url origin` -> Extract `OWNER` and `REPO`.
2.  **User Identity:**
    *   **MCP:** Fetch current user handle (if available).
    *   **CLI:** Use `@me` (Magic variable for current auth).
3.  **Label Strategy:**
    *   **Preferred:** `refactor`, `enhancement`, `bug`, `documentation`, `tech-debt`, `privacy`.
    *   **Logic:** Try to match specific features to these standard labels. If the tool fails on specific labels, retry with just `enhancement`.

## 2. Input Parsing
Parse the Markdown table strictly: `| Cohort Name | Summary |`
*   **Row Handling:** Treat each row as a distinct Issue.
*   **Title:** Use the Cohort Name (Col 1).
*   **Body:** Use the Summary (Col 2) + File list.

## 3. Execution Loop (The Resilience Chain)
For each row, execute the following priority chain.

### Strategy A: GitHub MCP (Fastest)
Attempt to call `github_create_issue`.
*   **Assignees:** `["<YOUR_HANDLE>"]` (If known) or leave blank and let logic handle it.
*   **Result:** If successful, capture the URL.
*   **Failure:** If 401/404/Error, **immediately** switch to Strategy B.

### Strategy B: GitHub CLI (Fallback)
If MCP fails, run this command in the terminal:
1.  **Verify:** Check `gh --version` exists.
2.  **Execute:**
    ```bash
    gh issue create \
      --title "[Cohort Name]" \
      --body "[Body Content]" \
      --label "enhancement" \
      --assignee "@me"
    ```
3.  **Capture:** The CLI outputs the new Issue URL. Capture it.

### Strategy C: Manual Dump (Last Resort)
If `gh` CLI is missing, print the raw Markdown for the user to copy.

## 4. Issue Content Template
Use this template for the Body:

```markdown
### Change Summary
[Summary Text]

### Files Affected
[List of files from Table]

### Verification
- [ ] Verify functionality locally
- [ ] Check for regressions
```

## 5. Post-Processing & Output

### Phase A: PR Enrichment
If `git branch --show-current` has an open PR:
1.  **MCP:** Call `github_update_pull_request` to append "Fixes" links.
2.  **CLI:** `gh pr edit --body "..."` (Append mode).

### Phase B: Final Output Block (Strict)
You must output the following summary block exactly:

> ## ðŸš€ Issues Created
> **Repo:** `OWNER/REPO`
>
> ### Commit Ready Comment:
> ```text
> Fixes: https://github.com/OWNER/REPO/issues/1 https://github.com/OWNER/REPO/issues/2
> ```
> *(Copy the line above into your PR description or Commit Message).*
